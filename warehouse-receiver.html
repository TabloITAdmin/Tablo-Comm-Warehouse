<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Warehouse Receiver</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<style>
  :root { --gap: 12px; --radius: 10px; --shadow: 0 6px 18px rgba(0,0,0,.08); }
* { box-sizing: border-box; }
body { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0f172a; color: #e5e7eb; }
header { padding: 16px 20px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #1f2937; position: sticky; top: 0; background: #0f172a; z-index: 5; }
header h1 { font-size: 18px; margin: 0; }
main { padding: 20px; display: grid; gap: var(--gap); grid-template-columns: 340px 1fr; }
@media (max-width: 980px) { main { grid-template-columns: 1fr; } }

.card { background: #111827; border: 1px solid #1f2937; border-radius: var(--radius); box-shadow: var(--shadow); }
.card h2 { font-size: 14px; margin: 0; padding: 14px 16px; border-bottom: 1px solid #1f2937; color: #93c5fd; }
.card .content { padding: 14px 16px; display: grid; gap: 10px; }

label { display: grid; gap: 6px; }
input, select { width: 100%; padding: 10px 12px; border: 1px solid #374151; border-radius: 8px; background: #0b1220; color: #e5e7eb; }
input::placeholder { color: #6b7280; }
.row { display: grid; gap: 10px; grid-template-columns: repeat(2, 1fr); }
@media (max-width: 540px) { .row { grid-template-columns: 1fr; } }

button { padding: 10px 14px; border: 1px solid #334155; background: #1f2937; color: #e5e7eb; border-radius: 8px; cursor: pointer; }
button.primary { background: #2563eb; border-color: #1d4ed8; }
button.warning { background: #ef4444; border-color: #b91c1c; }
button:disabled { opacity: .6; cursor: not-allowed; }
.toolbar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

table { width: 100%; border-collapse: collapse; }
th, td { border-bottom: 1px solid #1f2937; padding: 10px; text-align: left; vertical-align: top; }
thead th { position: sticky; top: 64px; background: #0b1220; z-index: 4; }
tbody tr:hover { background: #0b1220; }

.pill { font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid #1f2937; }
.pill.high { background: #991b1b; }
.pill.mid { background: #92400e; }
.pill.next { background: #065f46; }

.muted { color: #9ca3af; }
.right { text-align: right; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }

@media print {
  @page { size: A4 landscape; margin: 10mm; }
  header, .no-print { display: none !important; }
  body { background: #fff; color: #000; }
  .card { border: none; box-shadow: none; }
  thead th { position: static; background: #fff; }
  table, th, td { border-color: #999 !important; }
}

/* For Dashboard layout */
.dashboard {
  display: flex;
  height: 100vh;
}
.sidebar {
  width: 220px;
  background: #111827;
  color: #e5e7eb;
  display: flex;
  flex-direction: column;
  padding: 20px 10px;
}
.sidebar h2 {
  text-align: center;
  color: #93c5fd;
}
.sidebar .menu a {
  display: block;
  padding: 12px;
  margin: 6px 0;
  color: #e5e7eb;
  text-decoration: none;
  border-radius: 5px;
  transition: background 0.3s;
}
.sidebar .menu a:hover {
  background: #1f2937;
}
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #0f172a;
}
.main-header {
  background: #2563eb;
  color: white;
  padding: 15px;
  font-size: 20px;
}
iframe {
  flex: 1;
  border: none;
  width: 100%;
}

</style>
<body>
  <header>
    <h1>ðŸ“¦ Warehouse Receiver</h1>
  </header>
  <main>
    <section class="card">
      <h2>Pending Purchase Orders</h2>
      <div class="content">
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Product</th>
              <th>Qty Requested</th>
              <th>Qty Received</th>
              <th>Notes</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="ordersTable">
            <tr>
              <td colspan="6" class="muted">Loading orders...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
<form action="index.html">
    <input type="submit" value="BACK" class="button">
  </form>
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyA2jSob5blKCnBoFWn6Skx3kSg4rUKAGqQ",
      authDomain: "production-3e150.firebaseapp.com",
      databaseURL: "https://production-3e150-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "production-3e150",
      storageBucket: "production-3e150.firebasestorage.app",
      messagingSenderId: "287631316111",
      appId: "1:287631316111:web:2ebd4957b4e022ae534cfa"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Simple anonymous login
    firebase.auth().signInAnonymously();

    const tableBody = document.getElementById("ordersTable");

    // Load pending orders
    db.ref("purchaseOrders").on("value", snapshot => {
      tableBody.innerHTML = "";
      if (!snapshot.exists()) {
        tableBody.innerHTML = `<tr><td colspan="6" class="muted">No orders</td></tr>`;
        return;
      }

      snapshot.forEach(orderSnap => {
        const orderId = orderSnap.key;
        const order = orderSnap.val();

        if (order.status === "received") return; // skip completed

        order.items?.forEach((item, idx) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${orderId}</td>
            <td>${item.name}</td>
            <td>${item.qty}</td>
            <td><input type="number" id="recv-${orderId}-${idx}" value="${item.qty}" min="0"></td>
            <td><input type="text" id="note-${orderId}-${idx}" placeholder="Optional"></td>
            <td><button class="primary" onclick="markReceived('${orderId}', ${idx})">âœ… Confirm</button></td>
          `;
          tableBody.appendChild(row);
        });
      });
    });

    // Confirm receipt
    function markReceived(orderId, idx) {
      const recvInput = document.getElementById(`recv-${orderId}-${idx}`);
      const noteInput = document.getElementById(`note-${orderId}-${idx}`);
      const receivedQty = parseInt(recvInput.value) || 0;
      const notes = noteInput.value.trim();

      const orderRef = db.ref("purchaseOrders/" + orderId + "/items/" + idx);

      orderRef.update({
        receivedQty,
        notes,
        receivedAt: new Date().toISOString()
      }).then(() => {
        // Mark order as fully received if all items have receivedQty
        db.ref("purchaseOrders/" + orderId + "/items").once("value", snap => {
          let allReceived = true;
          snap.forEach(item => {
            if (!item.val().receivedQty) allReceived = false;
          });
          if (allReceived) {
            db.ref("purchaseOrders/" + orderId).update({ status: "received" });
          }
        });
      });
    }
  </script>
</body>

</html>